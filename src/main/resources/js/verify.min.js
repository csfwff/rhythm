var Verify={login:function(e){if(e=decodeURIComponent(e),Validate.goValidate({target:$("#loginTip"),data:[{target:$("#nameOrEmail"),type:"string",max:256,msg:Label.loginNameErrorLabel}]})){var t={nameOrEmail:$("#nameOrEmail").val().replace(/(^\s*)|(\s*$)/g,""),userPassword:calcMD5($("#loginPassword").val()),mfaCode:$("#mfaCode").val(),rememberLogin:$("#rememberLogin").prop("checked"),captcha:$("#captchaLogin").val().replace(/(^\s*)|(\s*$)/g,"")};$.ajax({url:Label.servePath+"/login",type:"POST",cache:!1,data:JSON.stringify(t),success:function(t,a){0===t.code?window.location.href=e:($("#loginTip").addClass("error").html("<ul><li>"+t.msg+"</li></ul>"),t.needCaptcha&&""!==t.needCaptcha&&($("#captchaImg").parent().show(),$("#captchaImg").attr("src",Label.servePath+"/captcha/login?needCaptcha="+t.needCaptcha+"&t="+Math.random()).click((function(){$(this).attr("src",Label.servePath+"/captcha/login?needCaptcha="+t.needCaptcha+"&t="+Math.random())}))))}})}},register:function(){if(Validate.goValidate({target:$("#registerTip"),data:[{target:$("#registerUserName"),msg:Label.invalidUserNameLabel,type:"string",max:20},{target:$("#registerUserPhone"),msg:"手机号码不合法",type:"phone"}]})){var e={userName:$("#registerUserName").val().replace(/(^\s*)|(\s*$)/g,""),userPhone:$("#registerUserPhone").val().replace(/(^\s*)|(\s*$)/g,""),invitecode:$("#registerInviteCode").val().replace(/(^\s*)|(\s*$)/g,""),captcha:$("#registerCaptcha").val()};let t="";""!==Util.getParameterByName("r")&&(t="?r="+Util.getParameterByName("r")),$.ajax({url:Label.servePath+"/register"+t,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code?($("#registerTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>"),$("#regForm, #gotoLoginBtn").hide(),$("#registerTip").before('<div class="input-wrap">\n    <svg><use xlink:href="#email"></use></svg>\n    <input id="registerVerifyCode" type="text" placeholder="短信验证码" autocomplete="off" />\n</div>'),$("#registerBtn").text("验证"),""!==Util.getParameterByName("r")?$("#registerBtn").attr("onclick",'location.href = Label.servePath + "/register?r=" + Util.getParameterByName("r") + "&code=" + $("#registerVerifyCode").val()'):$("#registerBtn").attr("onclick",'location.href = Label.servePath + "/register?code=" + $("#registerVerifyCode").val()')):($("#registerTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#registerCaptchaImg").attr("src",Label.servePath+"/captcha?code="+Math.random()),$("#registerCaptcha").val(""))}})}},register2:function(){if(Validate.goValidate({target:$("#registerTip2"),data:[{target:$("#registerUserPassword2"),msg:Label.invalidPasswordLabel,type:"password",max:20},{target:$("#registerConfirmPassword2"),original:$("#registerUserPassword2"),msg:Label.confirmPwdErrorLabel,type:"confirmPassword"}]})){var e={userAppRole:$("input[name=userAppRole]:checked").val(),userPassword:calcMD5($("#registerUserPassword2").val()),referral:$("#referral2").val(),userId:$("#userId2").val(),mbti:$("#mbtiReg").val()};let t="";""!==Util.getParameterByName("r")&&(t="?r="+Util.getParameterByName("r")),$.ajax({url:Label.servePath+"/register2"+t,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code?window.location.href=Label.servePath:$("#registerTip2").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}})}},forgetPwd:function(){if(Validate.goValidate({target:$("#fpwdTip"),data:[{target:$("#fpwdPhone"),msg:"手机号码不合法",type:"phone"},{target:$("#fpwdSecurityCode"),msg:Label.captchaErrorLabel,type:"string",max:4}]})){var e={userPhone:$("#fpwdPhone").val(),captcha:$("#fpwdSecurityCode").val()};$.ajax({url:Label.servePath+"/forget-pwd",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code?($("#fpwdTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>"),$("#fpwdPhone, #fpwdCaptcha, #fpwdSecurityCode").hide(),$("#fpwdTip").before('<div class="input-wrap">\n    <svg><use xlink:href="#email"></use></svg>\n    <input id="resetPwdVerifyCode" type="text" placeholder="短信验证码" autocomplete="off" />\n</div>'),$("#forgetBtn").text("验证"),$("#forgetBtn").attr("onclick",'location.href = Label.servePath + "/reset-pwd?code=" + $("#resetPwdVerifyCode").val()')):($("#fpwdTip").removeClass("tip-succ"),$("#fpwdTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#fpwdCaptcha").attr("src",Label.servePath+"/captcha?code="+Math.random()),$("#fpwdSecurityCode").val(""))}})}},resetPwd:function(){if(Validate.goValidate({target:$("#rpwdTip"),data:[{target:$("#rpwdUserPassword"),msg:Label.invalidPasswordLabel,type:"password",max:20},{target:$("#rpwdConfirmPassword"),original:$("#rpwdUserPassword"),msg:Label.confirmPwdErrorLabel,type:"confirmPassword"}]})){var e={userPassword:calcMD5($("#rpwdUserPassword").val()),userId:$("#rpwdUserId").val(),code:$("#code").val()};$.ajax({url:Label.servePath+"/reset-pwd",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code?window.location.href=Label.servePath:$("#rpwdTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}})}},init:function(){$("#registerCaptcha, #registerInviteCode").keyup((function(e){13===e.keyCode&&Verify.register()})),$("#fpwdSecurityCode").keyup((function(e){13===e.keyCode&&Verify.forgetPwd()})),$("#loginPassword, #captchaLogin, #mfaCode").keyup((function(e){13===e.keyCode&&$("#loginTip").next().click()})),$("#rpwdConfirmPassword").keyup((function(e){13===e.keyCode&&Verify.resetPwd()}))},initGuide:function(e,t){if(0===e)return window.location.href=Label.servePath,!1;var a="random",r=function(){switch(6!==e&&($(".intro dt").removeClass("current"),$(".guide-tab > div").hide()),e<6&&e>0&&$.ajax({url:Label.servePath+"/guide/next",type:"POST",cache:!1,data:JSON.stringify({userGuideStep:e}),success:function(e,t){0!==e.code&&Util.alert(e.msg)}}),e){case 1:$(".guide-tab > div:eq(0)").show(),$(".step-btn .red").hide(),$(".intro dt:eq(0)").addClass("current");break;case 2:$(".guide-tab > div:eq(1)").show(),$(".step-btn .red").show(),$(".intro dt:eq(1)").addClass("current"),$(".step-btn .green, .step-btn .red").prop("disabled",!0),$(".tag-desc").isotope({sortBy:a}),a="random"===a?"original-order":"random",$(".tag-desc").on("arrangeComplete",(function(){$(".step-btn .green, .step-btn .red").prop("disabled",!1)})),$(".tag-desc li").length<2&&$(".step-btn .green, .step-btn .red").prop("disabled",!1);break;case 3:$(".guide-tab > div:eq(2)").show(),$(".intro dt:eq(2)").addClass("current"),$(".step-btn .red").show();break;case 4:$(".guide-tab > div:eq(3)").show(),$(".intro dt:eq(3)").addClass("current"),$(".step-btn .red").show(),$(".step-btn .green").text(Label.nextStepLabel),$(".intro > div").hide(),$(".intro > dl").show();break;case 5:$(".guide-tab > div:eq(4)").show(),$(".step-btn .red").show(),$(".step-btn .green").text(Label.finshLabel),$(".intro > div").show(),$(".intro > dl").hide();break;case 6:window.location.href=Label.servePath}};$(".step-btn .green").click((function(){if(e>5)return!1;e++,r()})),$(".step-btn .red").click((function(){e--,r()})),$(".tag-desc li").click((function(){var e=$(this);e.hasClass("current")?(Util.unfollow(window,e.data("id"),"tag"),e.removeClass("current")):(Util.follow(window,e.data("id"),"tag"),e.addClass("current"))})),r(),$(".tag-desc").isotope({transitionDuration:"1.5s",filter:"li",layoutMode:"fitRows"});var s=parseInt(Math.random()*t);$(".tag-desc li:eq("+s+")").addClass("current"),Util.follow(window,$(".tag-desc li:eq("+s+")").data("id"),"tag")},loginSocket:null,initQrCodeLogin:function(){this.loginSocket=new WebSocket(Label.loginChannelURL),this.loginSocket.onopen=e=>{console.log("连接打开"),this.loginSocket.send(JSON.stringify({type:1}))},this.loginSocket.onmessage=function(e){console.log("收到消息:",e.data);let t=e.data;try{let e=document.querySelector("#qrcode_img");if(0===t.indexOf("targetId"))e.src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=web:"+t.split(":")[1];else if(0===t.indexOf("apiKey"))window.location.href=Label.servePath+"/loginWebInApiKey?apiKey="+t.split(":")[1];else if(0===t.indexOf("scan")){document.querySelector("#login-qrcode-div").classList.add("scan-ing")}}catch(e){}},this.loginSocket.onclose=e=>{console.log("WebSocket 连接已关闭")},this.loginSocket.onerror=e=>{console.log("WebSocket 出现错误:",e),this.loginSocket.close()}},closeQrCodeLogin:function(){this.loginSocket.close()}};