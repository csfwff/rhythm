var Util={bling:void 0,isBlinging:!1,genMetal(e,t){return"https://unv-shield.librian.net/api/unv_shield?scale=0.79&txt="+e+(t=void 0!==t&&""!==t?"&"+t:"")},parseDom(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes},parseArray(arrStr){var tempKey="arr23"+(new Date).getTime(),arrayJsonStr='{"'+tempKey+'":'+arrStr+"}",arrayJson,arrayJson=JSON&&JSON.parse?JSON.parse(arrayJsonStr):eval("("+arrayJsonStr+")");return arrayJson[tempKey]},fadeIn(t,a){let n=0;for(let e=0;e<100;e++)setTimeout(function(){n=+(n+.01).toFixed(2),t.style.opacity=n,99===e&&setTimeout(a,200)},5*e)},fadeOut(t,a){let n=1;for(let e=0;e<100;e++)setTimeout(function(){n=+(n-.01).toFixed(2),t.style.opacity=n,99===e&&setTimeout(a,400)},5*e)},getAtUsers:function(e){var a=[];return $.ajax({url:Label.servePath+"/users/names",type:"POST",async:!1,data:JSON.stringify({name:e}),success:function(e){if(0===e.code)for(var t=0;t<e.data.length;t++)a.push({value:"@"+e.data[t].userName+" ",html:'<img src="'+e.data[t].userAvatarURL+'"/>'+e.data[t].userName,avatar:e.data[t].userAvatarURL,username:e.data[t].userName});else alert(e.msg)}}),a},LazyLoadImage:function(){function t(e){var t=document.createElement("img");t.src=e.getAttribute("data-src"),t.addEventListener("load",function(){$(e).attr("style")||$(e).attr("class")||$(e).attr("width")||$(e).attr("height")||1!==$(e).closest(".vditor-reset").length||t.naturalHeight>t.naturalWidth&&t.naturalWidth/t.naturalHeight<$(e).closest(".vditor-reset").width()/($(window).height()-40)&&t.naturalHeight>$(window).height()-40&&(e.style.height=$(window).height()-40+"px"),$(e).attr("class")||1!==$(e).closest(".vditor-reset").length||_processPreview($(e)),e.src=t.src,e.style.backgroundImage="none",e.style.backgroundColor="transparent"}),e.removeAttribute("data-src")}if(!("IntersectionObserver"in window))return $("img").each(function(){this.getAttribute("data-src")&&t(this)}),!1;window.imageIntersectionObserver?window.imageIntersectionObserver.disconnect():window.imageIntersectionObserver=new IntersectionObserver(function(e){e.forEach(function(e){(void 0===e.isIntersecting?0!==e.intersectionRatio:e.isIntersecting)&&e.target.getAttribute("data-src")&&t(e.target)})}),$("img").each(function(){window.imageIntersectionObserver.observe(this)})},addStyle:function(e,t){var a;document.getElementById(t)||((a=document.createElement("link")).id=t,a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(a))},parseHljs:function(){Vditor.highlightRender({style:"github",enable:!Label.luteAvailable},document)},parseMarkdown:function(){Vditor.mermaidRender(document.body),Vditor.flowchartRender(document.body),Vditor.chartRender(),Vditor.mindmapRender(),Vditor.mathRender(document.body),Vditor.codeRender(document.body,Label.langLabel),Vditor.abcRender(),Vditor.graphvizRender(document.body),Vditor.plantumlRender(document.body);var e,t=!1;$(".vditor-reset").each(function(){$(this).find("a").each(function(){var e=$(this).attr("href");e&&".mov"===e.substr(e.length-4).toLowerCase()&&(t=!0)})}),t&&(e=function(){$(".vditor-reset").each(function(){$(this).find("a").each(function(){var e=$(this),t=$(this).attr("href");t&&".mov"===t.substr(t.length-4).toLowerCase()&&(this.style.height="360px",this.style.width="270px",e.removeAttr("href"),(e=LivePhotosKit.Player(this)).photoSrc=Label.staticServePath+"/images/livephoto.png",e.videoSrc=t)})})},"undefined"!=typeof LivePhotosKit?e():$.ajax({method:"GET",url:Label.staticServePath+"/js/lib/livephotoskit.js",dataType:"script",cache:!0}).done(function(){e()}))},prevKey:void 0,clipboard:function(e,t,a){e.click(function(e){t[0].select();try{document.execCommand("copy")?a():console.log("Copy command was unsuccessful")}catch(e){console.log("Oops, unable to copy")}window.getSelection().removeAllRanges()})},closeAlert:function(){$("#alertDialogPanel,.dialog-background").remove()},alert:function(e,t){void 0===t&&(t="");e='<div onclick="Util.closeAlert(this)" style="height: '+document.documentElement.scrollHeight+'px;display: block;" class="dialog-background"></div>'+('<div class="dialog-panel" id="alertDialogPanel" tabindex="0"><div class="fn-clear dialog-header-bg"><span style="font-size: 14px;">'+t+'</span><a class="icon-close" href="javascript:void(0);" onclick="Util.closeAlert()"><svg><use xlink:href="#close"></use></svg></a></div><div class="dialog-main" style="text-align:center;padding: 30px 10px 40px">'+e+"</div></div>");$("body").append(e),$("#alertDialogPanel").css({top:($(window).height()-$("#alertDialogPanel").height())/2+"px",left:($(window).width()-$("#alertDialogPanel").width())/2+"px",outline:"none"}).fadeIn(200).focus()},makeNotificationRead:function(e,a){return $.ajax({url:Label.servePath+"/notifications/make-read/"+e,type:"GET",cache:!1,success:function(e,t){0===e.code&&(Util.setUnreadNotificationCount(!1),$(".notification li").addClass("read"),a&&($(a).prev().remove(),$(a).remove(),0===$(".home-menu .count").length&&$(".module-header:last > span").remove()))}}),!1},_initCommonHotKey:function(){if(!Label.userKeyboardShortcutsStatus||"1"===Label.userKeyboardShortcutsStatus)return!1;function n(e){var t=$(".list > ul > li.focus"),a=0===$(".radio-btn").length?0:48;if(1===t.length){if("top"===e||"bottom"===e)return $(window).scrollTop(t.offset().top-a),0;($(window).height()+$(window).scrollTop()<t.offset().top+t.outerHeight()||$(window).scrollTop()>t.offset().top)&&("down"===e?$(window).scrollTop(t.offset().top-($(window).height()-t.outerHeight())):$(window).scrollTop(t.offset().top-a))}}0===$("#articleTitle").length&&$(document).bind("keydown","c",function(e){return Util.prevKey||(window.location=Label.servePath+"/post?type=0"),!1}),$(document).bind("keyup","g",function(){return Util.prevKey="g",setTimeout(function(){Util.prevKey=void 0},1e3),!1}).bind("keyup","s",function(){return $("#search").focus(),!1}).bind("keyup","t",function(){return void 0===Util.prevKey&&Util.goTop(),!1}).bind("keyup","n",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/notifications"),!1}).bind("keyup","h",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/hot"),!1}).bind("keyup","i",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath),!1}).bind("keyup","r",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/recent"),!1}).bind("keyup","p",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/perfect"),!1}).bind("keyup","Shift+/",function(e){return window.open(Label.servePath+"/article/1631459254239"),!1}).bind("keyup","j",function(e){var t=".content .list:last > ul > ";1===$("#comments").length&&(t="#comments .list > ul > ");var a=$(t+"li.focus");return 0===a.length?$(t+"li:first").addClass("focus"):1===a.next().length&&(a.next().addClass("focus"),a.removeClass("focus")),n("down"),!1}).bind("keyup","k",function(e){var t=".content .list:last > ul > ";1===$("#comments").length&&(t="#comments .list > ul > ");var a=$(t+"li.focus");return 0===a.length?$(t+"li:last").addClass("focus"):1===a.prev().length&&(a.prev().addClass("focus"),a.removeClass("focus")),n("up"),!1}).bind("keyup","f",function(e){var t=".content .list:last > ul > ";return 1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus").removeClass("focus"),$(t+"li:first").addClass("focus"),n("top"),!1}).bind("keyup","l",function(e){if(Util.prevKey)return!1;var t=".content .list:last > ul > ";return 1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus").removeClass("focus"),$(t+"li:last").addClass("focus"),n("bottom"),!1}).bind("keyup","o",function(e){if(1===$("#comments").length)return!1;var t=$(".content .list:last > ul > li.focus > h2 > a").attr("href");return(t=(t=t||$(".content .list:last > ul > li.focus .fn-flex-1 > h2 > a").attr("href"))||$(".content .list:last > ul > li.focus h2.fn-flex-1 > a").attr("href"))&&(window.location=t),!1}).bind("keyup","return",function(e){if(1===$("#comments").length)return!1;var t=$(".content .list:last > ul > li.focus > h2 > a").attr("href");return(t=(t=t||$(".content .list:last > ul > li.focus .fn-flex-1 > h2 > a").attr("href"))||$(".content .list:last > ul > li.focus h2.fn-flex-1 > a").attr("href"))&&(window.location=t),!1})},notifyMsg:function(t){if(!("Notification"in window))return!1;function a(e){(e=new Notification(Label.visionLabel,{body:Label.desktopNotificationTemplateLabel.replace("${count}",e),icon:Label.staticServePath+"/images/faviconH.png"})).onclick=e.onerror=function(){window.location=Label.servePath+"/notifications"}}"granted"===Notification.permission?a(t):"denied"!==Notification.permission&&Notification.requestPermission(function(e){"granted"===e&&a(t)})},processClipBoard:function(e,n){if(""===e.getData("text/html")&&2===e.items.length)return"";var t=!1,a=toMarkdown(e.getData("text/html"),{converters:[{filter:"img",replacement:function(e,t){if(1===t.attributes.length)return"";var a={url:t.src};return $.ajax({url:Label.servePath+"/fetch-upload",type:"POST",data:JSON.stringify(a),cache:!1,success:function(e,t){var a;0===e.code&&(a=(a=n.getValue()).replace(e.originalURL,e.url),n.setValue(a))}}),"![]("+t.src+")"}},{filter:["pre","code"],replacement:function(e){return 1<e.split("\n").length&&(t=!0),"`"+e+"`"}}],gfm:!0});if(t)return event.originalEvent.clipboardData.getData("text/plain");e=document.createElement("div");return e.innerHTML=a,e.innerText.replace(/\n{2,}/g,"\n\n").replace(/(^\s*)|(\s*)$/g,"")},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},getDeviceByUa:function(e){$.ua.set(e);e=$.ua.device.model||$.ua.os.name;return e=!e||"Windows"===e?"":e},initSearch:function(e,t,a){var n=algoliasearch(e,t).initIndex(a);$("#search").autocomplete({hint:!1,templates:{footer:'<div class="fn-right fn-pointer" onclick="window.open(\'https://www.algolia.com\')"><span class="ft-gray">With &hearts; from</span> <img src="'+Label.staticServePath+'/images/services/algolia128x40.png" /> </div>'}},[{source:function(e,a){n.search(e,{hitsPerPage:20},function(e,t){e?a([]):a(t.hits,t)})},displayKey:"name",templates:{suggestion:function(e){return e._highlightResult.articleTitle.value}}}]).on("autocomplete:selected",function(e,t,a){window.open(Label.servePath+"/article/"+t.oId)}).bind("keyup","esc",function(){$(this).blur()})},newVditor:function(e){Label.emoji||$.ajax({url:Label.servePath+"/users/emotions",type:"GET",cache:!0,async:!1,success:function(e){Label.emoji={},e.data.forEach(function(e){var t=Object.keys(e)[0];Label.emoji[t]=e[t]})}});var t={outline:e.outline||{enable:!1},after:e.after||void 0,typewriterMode:e.typewriterMode||!1,cache:{enable:e.cache||!1},input:e.input,preview:{delay:500,mode:e.preview.mode,url:Label.servePath+"/markdown",parse:function(e){"none"!==e.style.display&&Util.LazyLoadImage()},hljs:{enable:!Label.luteAvailable}},upload:{max:Label.fileMaxSize,url:Label.servePath+"/upload",filename:function(e){return e.replace(/\?|\\|\/|:|\||<|>|\*|\[|\]|\s+/g,"-")},accept:".zip,.rar,.7z,.tar,.gzip,.bz2,.jar,.jpg,.jpeg,.png,.gif,.webp,.webm,.bmp,.mp3,.mp4,.wav,.mov,.weba,.mkv"},placeholder:e.placeholder,height:e.height,counter:{enable:!!e.counter,max:e.counter},resize:{enable:e.resize.enable,position:e.resize.position},lang:Label.langLabel,hint:{parse:!1,emojiTail:'<a href="'+Label.servePath+'/settings/function" target="_blank">设置常用表情</a>',emoji:Label.emoji,extend:[{key:"@",hint:function(a){var n=[];return $.ajax({url:Label.servePath+"/users/names",type:"POST",async:!1,data:JSON.stringify({name:a}),success:function(e){if(0===e.code){for(var t=0;t<e.data.length;t++)n.push({value:"@"+e.data[t].userName+" ",html:'<img src="'+e.data[t].userAvatarURL+'"/>'+e.data[t].userName});""===a&&n.push({html:'<img src="'+Label.staticServePath+'/images/user-thumbnail.png"/> 参与者',value:"@participants "})}else alert(e.msg)}}),n}}]},esc:e.esc,ctrlEnter:e.ctrlEnter};return $(window).width()<768?(t.toolbar=["emoji","link","upload","edit-mode",{name:"more",toolbar:["insert-after","fullscreen","preview","info","help"]}],t.resize.enable=!1):e.toolbar&&(t.toolbar=e.toolbar),new Vditor(e.id,t)},setUnreadNotificationCount:function(o){$.ajax({url:Label.servePath+"/notifications/unread/count",type:"GET",cache:!1,success:function(e,t){function a(e){var t="",a='<span onclick="Util.makeNotificationRead(\'${markReadType}\');return false;" aria-label="'+Label.makeAsReadLabel+'" class="fn-right tooltipped tooltipped-nw"><svg><use xlink:href="#check"></use></svg></span>';return 0<e.unreadCommentedNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/commented">'+Label.notificationCommentedLabel+' <span class="count">'+e.unreadCommentedNotificationCnt+"</span>"+a.replace("${markReadType}","commented")+"</a></li>"),0<e.unreadReplyNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/reply">'+Label.notificationReplyLabel+' <span class="count">'+e.unreadReplyNotificationCnt+"</span>"+a.replace("${markReadType}","reply")+"</a></li>"),0<e.unreadAtNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/at">'+Label.notificationAtLabel+' <span class="count">'+e.unreadAtNotificationCnt+"</span>"+a.replace("${markReadType}","at")+"</a></li>"),0<e.unreadFollowingNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/following">'+Label.notificationFollowingLabel+' <span class="count">'+e.unreadFollowingNotificationCnt+"</span>"+a.replace("${markReadType}","following")+"</a></li>"),0<e.unreadPointNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/point">'+Label.pointLabel+' <span class="count">'+e.unreadPointNotificationCnt+"</span></a></li>"),0<e.unreadBroadcastNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/broadcast">'+Label.sameCityLabel+' <span class="count">'+e.unreadBroadcastNotificationCnt+"</span></a></li>"),0<e.unreadSysAnnounceNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/sys-announce">'+Label.systemLabel+' <span class="count">'+e.unreadSysAnnounceNotificationCnt+"</span></a></li>"),0<e.unreadNewFollowerNotificationCnt&&(t+='<li><a href="'+Label.servePath+"/member/"+Label.currentUserName+'/followers">'+Label.newFollowerLabel+' <span class="count">'+e.unreadNewFollowerNotificationCnt+"</span></a></li>"),t}var n=e.unreadNotificationCnt;if($.ua.set(navigator.userAgent),$.ua.device.type&&"mobile"===$.ua.device.type){if(0<n){$("#aNotifications").removeClass("no-msg").addClass("msg").text(n).attr("href","javascript:void(0)"),0===e.userNotifyStatus&&window.localStorage.hadNotificate!==n.toString()&&o&&(Util.notifyMsg(n),window.localStorage.hadNotificate=n);var i=a(e);if(1===$("#notificationsPanel").length)return $("#notificationsPanel ul").html(i),!1;$(".main:first").prepend('<div id="notificationsPanel" class="tab-current fn-clear fn-none"><ul class="tab fn-clear">'+i+"</ul></div>"),$("#aNotifications").click(function(){$("#notificationsPanel").slideToggle()})}else window.localStorage.hadNotificate="false",$("#aNotifications").removeClass("msg").addClass("no-msg").text(n).attr("href",Label.servePath+"/notifications");return!1}if(0<n){$("#aNotifications").removeClass("no-msg tooltipped tooltipped-w").addClass("msg").text(n).attr("href","javascript:void(0)"),0===e.userNotifyStatus&&window.localStorage.hadNotificate!==n.toString()&&o&&(Util.notifyMsg(n),window.localStorage.hadNotificate=n);i=a(e);if(1===$("#notificationsPanel").length)return $("#notificationsPanel ul").html(i),!1;$("#aNotifications").after('<div id="notificationsPanel" class="module person-list"><ul>'+i+"</ul></div>"),$("#aNotifications").click(function(){$("#notificationsPanel").show()}),$("body").click(function(e){"aNotifications"!==e.target.id&&"notificationsPanel"!==$(e.target).closest(".module").attr("id")&&$("#notificationsPanel").hide()})}else window.localStorage.hadNotificate="false",$("#notificationsPanel").remove(),$("#aNotifications").removeClass("msg").addClass("no-msg tooltipped tooltipped-w").text(n).attr("href",Label.servePath+"/notifications")}})},follow:function(a,n,i,o){if(!Label.isLoggedIn)return Util.needLogin(),!1;if($(a).hasClass("disabled"))return!1;var e={followingId:n};$(a).addClass("disabled"),$.ajax({url:Label.servePath+"/follow/"+i,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code&&($(a).removeClass("disabled"),void 0!==o?"article"===i||"tag"===i?$(a).html('<svg class="icon-star"><use xlink:href="#star"></use></svg> '+(o+1)).attr("onclick","Util.unfollow(this, '"+n+"', '"+i+"', "+(o+1)+")").attr("aria-label",Label.uncollectLabel).addClass("ft-red"):"article-watch"===i&&$(a).html('<svg class="icon-view"><use xlink:href="#view"></use></svg> '+(o+1)).attr("onclick","Util.unfollow(this, '"+n+"', '"+i+"', "+(o+1)+")").attr("aria-label",Label.unfollowLabel).addClass("ft-red"):$(a).attr("onclick","Util.unfollow(this, '"+n+"', '"+i+"')").text("article"===i?Label.uncollectLabel:Label.unfollowLabel))},complete:function(){$(a).removeClass("disabled")}})},unfollow:function(a,n,i,o){if($(a).hasClass("disabled"))return!1;var e={followingId:n};$(a).addClass("disabled"),$.ajax({url:Label.servePath+"/unfollow/"+i,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code&&(void 0!==o?"article"===i||"tag"===i?$(a).removeClass("ft-red").html('<svg class="icon-star"><use xlink:href="#star"></use></svg> '+(o-1)).attr("onclick","Util.follow(this, '"+n+"', '"+i+"',"+(o-1)+")").attr("aria-label",Label.collectLabel):"article-watch"===i&&$(a).removeClass("ft-red").html('<svg class="icon-view"><use xlink:href="#view"></use></svg> '+(o-1)).attr("onclick","Util.follow(this, '"+n+"', '"+i+"',"+(o-1)+")").attr("aria-label",Label.followLabel):$(a).attr("onclick","Util.follow(this, '"+n+"', '"+i+"')").text("article"===i?Label.collectLabel:Label.followLabel))},complete:function(){$(a).removeClass("disabled")}})},goTop:function(){$("html, body").animate({scrollTop:0},800)},goLogin:function(){var e;-1===location.href.indexOf("/login")&&(e=location.href,0===location.search.indexOf("?goto")&&(e=location.href.replace(location.search,"")),window.location.href=Label.servePath+"/login?goto="+encodeURIComponent(e))},needLogin:function(){Util.goLogin()},goRegister:function(){var e;-1===location.href.indexOf("/register")&&(e=location.href,0===location.search.indexOf("?goto")&&(e=location.href.replace(location.search,"")),window.location.href=Label.servePath+"/register?goto="+encodeURIComponent(e))},_kill:function(){"IE"===$.ua.browser.name&&parseInt($.ua.browser.version)<10&&$.ajax({url:Label.servePath+"/kill-browser",type:"GET",cache:!1,success:function(e,t){$("body").append(e),$("#killBrowser").dialog({modal:!0,hideFooter:!0,height:345,width:600}),$("#killBrowser").dialog("open")}})},_initActivity:function(){var e=$(".person-info"),t=e.data("percent"),a=0,n=0,i=0;t<=25?a=parseInt(t/.25):t<=75?(a=100,n=parseInt((t-25)/2/.25)):t<=100&&(n=a=100,i=parseInt((t-75)/.25)),e.find(".bottom").css({width:a+"%",left:(100-a)/2+"%"}),e.find(".top-left").css({width:parseInt(i/2)+"%",left:0}),e.find(".top-right").css({width:parseInt(i/2)+"%",right:0}),e.find(".left").css({height:n+"%",top:100-n+"%"}),e.find(".right").css({height:n+"%",top:100-n+"%"})},_initBreezemoon:function(t,e,a){0!==t.length&&(e.keypress(function(e){13===e.keyCode&&t.click()}),t.click(function(){a?"disabled"!==t.attr("disabled")&&(t.attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/breezemoon",type:"POST",cache:!1,headers:{csrfToken:$(this).data("csrf")},data:JSON.stringify({breezemoonContent:e.val()}),success:function(e){0===e.code?window.location.reload():Util.alert(e.msg)},complete:function(){t.css("opacity",1).removeAttr("disabled")}})):Util.goLogin()}))},init:function(e){if($.ua.set(navigator.userAgent),"mobile"!==$.ua.device.type&&($("body").append('<div id="userCard" style="position: absolute; z-index: 130; right: auto; display: none; "></div>'),Util.listenUserCard()),this._kill(),this._initNav(),this._initActivity(),1===$(".pagination select").length&&$(".pagination select").change(function(){var e=$(this).data("url")+"?p="+$(this).val();$(this).data("param")&&(e+="&"+$(this).data("param")),window.location.href=e}),$(".nav input.search").focus(function(){$(".nav .tags").css("visibility","hidden")}).blur(function(){$(".nav .tags").css("visibility","visible")}),$(window).scroll(function(){20<$(window).scrollTop()&&0===$(".radio-btn").length?$(".go-top").show():$(".go-top").hide()}),Util.parseMarkdown(),Util.parseHljs(),e&&(window.localStorage.hadNotificate||(window.localStorage.hadNotificate="false"),Util.setUnreadNotificationCount(!0)),$(window).keyup(function(e){27===e.keyCode&&Util.closeAlert()}),this._initBreezemoon($("#breezemoonPostBtn"),$("#breezemoonInput"),e),this._initCommonHotKey(),e)return!1;$("body").click(function(e){0===$(e.target).closest(".nav .form").length&&$(".nav .form").hide()})},listenUserCard:function(){var a=!1;$(".avatar, .avatar-small, .avatar-middle, .avatar-mid, .avatar-big, .name-at").unbind(),$(".avatar, .avatar-small, .avatar-middle, .avatar-mid, .avatar-big, .name-at").hover(function(){if(void 0!==$(this).attr("aria-label")){var i=$(this).attr("aria-label");let t;$.ajax({url:Label.servePath+"/user/"+i,type:"GET",cache:!1,async:!1,headers:{csrfToken:Label.csrfToken},success:function(e){t=e}});t.followerCount,t.followingUserCount;var o=t.oId,r=(t.onlineMinute,t.userAvatarURL),l=t.userCity,s=t.userIntro,c=t.userName,u=t.userNickname,d=t.userOnlineFlag,f=t.userPoint,g=(t.userURL,t.userRole),h=t.cardBg,p=t.canFollow,v=t.userNo,b=t.userAppRole,i=JSON.parse(t.sysMetal);let a='<div class="user-card" id="userCardContent">\n    <div>\n        <a href="'+Label.servePath+"/member/"+c+'">\n            <div class="avatar-mid-card" style="background-image: url('+r+');"></div>\n        </a>\n        <div class="user-card__meta">\n            <div class="fn__ellipsis">\n                <a class="user-card__name" href="'+Label.servePath+"/member/"+c+'"><b>'+u+'</b></a>\n                <a class="ft-gray ft-smaller" href="'+Label.servePath+"/member/"+c+'"><b>'+c+"</b></a>\n";a+="            </div>\n",""!==s?a+='            <div class="user-card__info vditor-reset">\n                '+s+"\n            </div>\n":"0"===b?a+='<div class="user-card__info vditor-reset">摸鱼派 '+v+" 号成员，<b>黑客</b></div>\n":"1"===b&&(a+='<div class="user-card__info vditor-reset">摸鱼派 '+v+" 号成员，<b>画家</b></div>\n");var m=i.list;if(void 0!==m&&0!==m.length){a+='<div class="user-card__info vditor-reset">';for(let e=0;e<m.length;e++){var w=m[e];a+="<img title='"+w.description+"' src='"+Util.genMetal(w.name,w.attr)+"'/>"}a+="</div>"}switch(a+='            <div class="user-card__icons fn__flex">\n                <div class="fn__flex-1">\n                    <a href="https://pwl.icu/article/1630575841478" class="tooltipped__n tooltipped-new"\n                       aria-label="用户分组：'+g+'">\n',g){case"管理员":a+='<img style="height: 20px;margin: 0px;" src="https://pwl.stackoverflow.wiki/adminRole.png"/>';break;case"OP":a+='<img style="height: 20px;margin: 0px;" src="https://pwl.stackoverflow.wiki/opRole.png"/>';break;case"协警":a+='<img style="height: 20px;margin: 0px;" src="https://pwl.stackoverflow.wiki/policeRole.png"/>';break;case"超级会员":a+='<img style="height: 20px;margin: 0px;" src="https://pwl.stackoverflow.wiki/svipRole.png"/>';break;case"成员":a+='<img style="height: 20px;margin: 0px;" src="https://pwl.stackoverflow.wiki/vipRole.png"/>';break;default:a+='<img style="height: 20px;margin: 0px;" src="https://pwl.stackoverflow.wiki/newRole.png"/>'}a+="                    </a>\n",a+='                    <a href="'+Label.servePath+"/member/"+c+'/points" class="tooltipped-new tooltipped__n"\n                       aria-label="'+f+' 积分">\n                        <svg>\n                            <use xlink:href="#iconPoints"></use>\n                        </svg>\n                    </a>\n',""!==l&&(a+='<a href="'+Label.servePath+"/city/"+l+'" class="tooltipped-new tooltipped__n" rel="nofollow"\n   aria-label="'+l+'">\n    <svg>\n        <use xlink:href="#icon-local"></use>\n    </svg>\n</a>\n'),a+="                </div>\n",a+=!0===d?'<span style="background-color:#d23f31;color:#fff;font-size:12px;line-height:20px;border-radius:3px;height:20px;display:inline-block;padding:0 5px;vertical-align:middle;box-sizing:border-box;">在线</span>':'<span style="background-color:rgba(0,0,0,0.54);color:#fff;font-size:12px;line-height:20px;border-radius:3px;height:20px;display:inline-block;padding:0 5px;vertical-align:middle;box-sizing:border-box;">离线</span>',a+='                <div class="fn__shrink">\n                    <a class="green small btn" href="'+Label.servePath+"/idle-talk?toUser="+c+'" rel="nofollow">\n                        私信\n                    </a>\n',"yes"===p?a+='<button class="follow small" onclick="Util.follow(this, \''+o+"', 'user')\">\n 关注\n</button>":"no"===p&&(a+='<button class="follow small" onclick="Util.unfollow(this, \''+o+"', 'user')\">\n 取消关注\n</button>"),a+="                </div>\n            </div>\n        </div>\n    </div>\n</div>",$("#userCard").html(a),""!==h&&($("#userCardContent").addClass("user-card--bg"),$("#userCardContent").css("background-image","url("+h+")"),$("#userCardContent > div").attr("style","background-image: linear-gradient(90deg, rgba(214, 227, 235, 0.36), rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0.76));"),$("#userCardContent > div > a > div").css("width","105px"),$("#userCardContent > div > a > div").css("height","105px"),$("#userCardContent > div > a > div").css("top","80px"));let e=$(this).offset().left;e+=30,e+350>$(document.body).width()&&(e-=350),$("#userCard").css("left",e);let n=$(this).offset().top-110;n<45&&(n=$(this).offset().top+45),$("#userCard").css("top",n+"px"),$("#userCard").show()}},function(t){setTimeout(function(){var e=$(t.toElement);0===$(e).parents("#userCard").length&&(a||$("#userCard").hide())},50)}),$("#userCard").unbind(),$("#userCard").hover(function(){a=!0},function(){a=!1,$("#userCard").hide()})},initUserChannel:function(e){var t=new ReconnectingWebSocket(e);t.reconnectInterval=1e3,t.onopen=function(){console.log("Connected to user channel websocket."),setInterval(function(){t.send("-hb-")},3e5)},t.onmessage=function(e){switch(JSON.parse(e.data).command){case"refreshNotification":"/"===window.location.pathname||"/cr"===window.location.pathname?(Util.makeNotificationRead("at"),Util.setUnreadNotificationCount(!0)):(Util.setUnreadNotificationCount(!0),Util.notice("default",3e3,"你有一条新的通知！<a href='/notifications'>点击查看</a>"));break;case"newIdleChatMessage":"/idle-talk"!==window.location.pathname&&(Util.blingChat(),Util.notice("warning",3e3,"叮咚！你收到了一条私信。<a href='/idle-talk'>点击查看</a>"))}},t.onclose=function(){console.log("Disconnected to user channel websocket.")},t.onerror=function(e){console.log("ERROR",e)}},blingChat:function(){Util.isBlinging||(Util.isBlinging=!0,$("#idleTalkIconContainer").html('<use xlink:href="#redIdleChat"></use>'),setTimeout(function(){$("#idleTalkIconContainer").html('<use xlink:href="#idleChat"></use>')},1e3),bling=setInterval(function(){$("#idleTalkIconContainer").html('<use xlink:href="#redIdleChat"></use>'),setTimeout(function(){$("#idleTalkIconContainer").html('<use xlink:href="#idleChat"></use>')},1e3)},2e3))},pauseBling:function(){Util.isBlinging&&(Util.isBlinging=!1,clearInterval(bling))},_initNav:function(){var e=location.href;$(".user-nav > a").each(function(){0===e.indexOf($(this).attr("href"))?$(this).addClass("current"):"/register"===location.pathname?$(".user-nav a:last").addClass("current"):"/login"===location.pathname?$(".user-nav a:first").addClass("current"):0!==e.indexOf(Label.servePath+"/settings")&&0!==e.indexOf($("#aPersonListPanel").data("url"))||$("#aPersonListPanel").addClass("current")}),$(".nav .avatar-small").parent().click(function(){$("#personListPanel").show()}),$("body").click(function(e){"aPersonListPanel"!==$(e.target).closest("a").attr("id")&&"personListPanel"!==$(e.target).closest(".module").attr("id")&&$("#personListPanel").hide()}),1===$(".nav-tabs a:last").length&&0<$(".nav-tabs a:last")[0].offsetTop&&$(".nav-tabs").mouseover(function(){$(".user-nav").hide()}).mouseout(function(){$(".user-nav").show()})},logout:function(){window.localStorage&&(window.localStorage.clear(),window.localStorage.hadNotificate="false"),window.location.href=Label.servePath+"/logout?goto="+Label.servePath},startsWith:function(e,t){return e.match("^"+t)==t},mouseClickEffects:function(){var o=0;jQuery(document).ready(function(i){i("html").click(function(e){var t,a=18;10==++o?t=i("<b></b>").text("OωO"):20===o?t=i("<b></b>").text("(๑•́ ∀ •̀๑)"):30===o?t=i("<b></b>").text("(๑•́ ₃ •̀๑)"):40===o?t=i("<b></b>").text("(๑•̀_•́๑)"):50===o?t=i("<b></b>").text("（￣へ￣）"):60===o?t=i("<b></b>").text("(╯°口°)╯(┴—┴"):70===o?t=i("<b></b>").text("૮( ᵒ̌皿ᵒ̌ )ა"):80===o?t=i("<b></b>").text("╮(｡>口<｡)╭"):90===o?t=i("<b></b>").text("( ง ᵒ̌皿ᵒ̌)ง⁼³₌₃"):100<=o&&o<=105?t=i("<b></b>").text("(ꐦ°᷄д°᷅)"):(t=i('<svg><use xlink:href="#heart"></use></svg>'),a=Math.round(14*Math.random()+6));var n=e.pageX,e=e.pageY;t.css({"z-index":9999,top:e-20,left:n,position:"absolute",color:"#E94F06","font-size":a,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),i("body").append(t),t.animate({top:e-180,opacity:0},1500,function(){t.remove()})})})},notice:function(e,t,a,n){void 0!==n?$.tooltips(a,{type:e,duration:t,callback:n}):$.tooltips(a,{type:e,duration:t})}},Validate={goValidate:function(e){for(var t="<ul>",a=0;a<e.data.length;a++)Validate.validate(e.data[a])||(t+="<li>"+e.data[a].msg+"</li>");return"<ul>"===t?(e.target.html(""),e.target.removeClass("error"),!0):(e.target.html(t+"</ul>"),e.target.addClass("error"),!1)},validate:function(e){var t=!0,a="",a="editor"===e.type?e.target.getValue():"imgSrc"===e.type?e.target.attr("src"):"imgStyle"===e.type?e.target.data("imageurl"):e.target.val().toString().replace(/(^\s*)|(\s*$)/g,"");switch(e.type){case"email":/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e.target.val())||(t=!1);break;case"password":!(e.target.val().length<6||16<e.target.val().length)&&/\d/.test(e.target.val())&&/[A-Za-z]/.test(e.target.val())||(t=!1);break;case"confirmPassword":e.target.val()!==e.original.val()&&(t=!1);break;case"tags":var n=a.split(",");(""===a||7<n.length)&&(t=!1);for(var i=0;i<n.length;i++)if(""===n[i].replace(/(^\s*)|(\s*$)/g,"")||50<n[i].replace(/(^\s*)|(\s*$)/g,"").length){t=!1;break}break;case"url":case"imgSrc":case"imgStyle":(""===a||""!==a&&(!/^\w+:\/\//.test(a)||100<a.length))&&(t=!1);break;default:t=a.length<=e.max&&a.length>=(e.min||0)}return t}},Label={},pngMagic=[137,80,78,71,13,10,26,10],jpeg_jfif=[74,70,73,70],jpeg_exif=[69,120,105,102],jpegMagic=[255,216,255,224],gifMagic0=[71,73,70,56,55,97],getGifMagic1=[71,73,70,56,57,97],wavMagic1=[82,73,70,70],wavMagic2=[87,65,86,69];function arraycopy(e,t,a,n,o){for(i=0;i<o;i++)a[n+i]=e[t+i]}function arrayEquals(e,t){if("undefined"==e||"undefined"==t)return!1;if(e instanceof Array&&t instanceof Array){if(e.length!=t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}return!1}function isImage(e){return null!==getImageMime(e)}function getImageMime(e){if(null==e||"undefined"==e||e.length<8)return null;var t=[];return arraycopy(e,0,t,0,6),isGif(t)?"image/gif":(arraycopy(e,6,t=[],0,4),isJpeg(t)?"image/jpeg":(arraycopy(e,0,t=[],0,8),isPng(t)?"image/png":null))}function isAudio(e){if(null==e||"undefined"==e||e.length<12)return null;var t=[];arraycopy(e,0,t,0,4);var a=[];return arraycopy(e,8,a,0,4),isWav(t,a)?"audio/wav":null}function isGif(e){return arrayEquals(e,gifMagic0)||arrayEquals(e,getGifMagic1)}function isJpeg(e){return arrayEquals(e,jpegMagic)||arrayEquals(e,jpeg_jfif)||arrayEquals(e,jpeg_exif)}function isPng(e){return arrayEquals(e,pngMagic)}function isWav(e,t){return arrayEquals(e,wavMagic1)&&arrayEquals(t,wavMagic2)}function getUUID(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==e?t:3&t|8).toString(16)}).replace(new RegExp("-","g"),"")}var Audio={availabel:!1,wavFileBlob:null,recorderObj:null,init:function(i){var e=new BrowserGetUserMediaDetection;e.getUserMediaSupported()?(navigator.getUserMedia=e.getUserMediaMethod(),navigator.getUserMedia({audio:!0},function(e){var t=PredefinedRecordingModes.MONO_5_KHZ,a=t.getSampleRate(),n=t.getChannelCount(),t=new BrowserWindowAudioContextDetection;t.windowAudioContextSupported()?(t=t.getWindowAudioContextMethod(),Audio.recorderObj=new SoundRecorder(t,2048,a,n),Audio.recorderObj.init(e),Audio.recorderObj.recorder.onaudioprocess=function(e){var t;Audio.recorderObj.isRecording()&&(t=e.inputBuffer.getChannelData(0),e=e.inputBuffer.getChannelData(1),Audio.recorderObj.cloneChannelData(t,e))},Audio.availabel=!0,i&&i()):console.log("getUserMedia->success(): Unable to detect window audio context, cannot continue.")},function(e){console.log("getUserMedia->failure(): ERROR: Microphone access request failed!");switch(e.name){case"PermissionDeniedError":Label.recordDeniedLabel;break;case"DevicesNotFoundError":Label.recordDeviceNotFoundLabel;break;default:e.name}})):console.log("ERROR: getUserMedia not supported by browser.")},handleStartRecording:function(){Audio.recorderObj.startRecordingNewWavFile()},handleStopRecording:function(){Audio.recorderObj.stopRecording(),Audio.wavFileBlob=Audio.recorderObj.buildWavFileBlob()}};function Rotate(n){let i=!1,o=!1;this.submit=function(){if(!o){o=!0;let e=0,t,a;void 0===a&&(t=document.getElementById(n).getAttribute("style"),null!==t&&void 0!==t&&""!==t?t.endsWith(";")||(t+=";"):t="",a=setInterval(function(){e+=5,360<e&&(e=0),document.getElementById(n).setAttribute("style",t+"-webkit-transform: rotate("+e+"deg);"),0===e&&i&&(clearInterval(a),document.getElementById(n).setAttribute("style",t),o=!1)},15))}},this.stop=function(){i=!0},String.prototype.endWith=function(e){var t=this.length-e.length;return 0<=t&&this.lastIndexOf(e)===t}}$(function(){let e=new Date;11==e.getMonth()&&13==e.getDate()&&($("html").css("filter","grayscale(100%)"),$("html").css("-webkit-filter","grayscale(100%)"))});